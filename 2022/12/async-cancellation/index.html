<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#3367D6"/>
  <link rel="apple-touch-icon" href="/icons-192.png">
  <link rel="manifest" href="/manifest.json">
  
  <meta name="generator" content="Hexo 6.0.0">

  
    <meta name="description" content="Wayne&#39;s personal blog">
  

  

  
    <meta name="author" content="Wayne">
  

  

  

  <title>The Hidden Control Flow | Wonderland</title>

  
    <link rel="alternate" href="/atom.xml" title="Wonderland" type="application/atom+xml">
  

  
    <link rel="shortcut icon" href="/favicon.ico">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@1.1.3/index.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/styles/monokai.css">
  

  
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
  <div class="root-container">
    
<!-- header container -->
<header class="header-container post">
  
    <div class="post-image" style="background-image: url(https://raw.githubusercontent.com/waynexia/flexblock-modified/main/source/89433360_p0.jpg)"></div>
  

  <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          Wonderland
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">Home</a></li>
        
          <li class="navbar-list-item"><a href="/about">About</a></li>
        

        <li class="navbar-list-item">|</li>

        <li class="navbar-list-item"><a href="javascript:;" id="theme-light">üåû Light</a></li>
        <li class="navbar-list-item"><a href="javascript:;" id="theme-dark">üåõ Dark</a></li>
        <li class="navbar-list-item"><a href="javascript:;" id="theme-auto">üåó Auto</a></li>
      </ul>
    </div>
  </div>
</nav>

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-text layout-block">
        <div class="layout-margin">
          <h1 class="title-wrap">The Hidden Control Flow</h1>
          <h2 class="title-sub-wrap">
            <strong>Wayne</strong>
            <span>write on</span>
            <time  class="article-date" datetime="2022-12-04T16:06:19.000Z" itemprop="datePublished">2022-12-04</time>
          </h2>
          <ul class="wrap-list dark">
  
</ul>
          <ul class="wrap-list dark">
  
    <li><a href="/tags/Rust/">üè∑Ô∏è Rust</a></li>
  
</ul>
        </div>
      </div>
    </div>
  

  
  
  
</header>

    <!-- ÊñáÁ´† -->

<!-- ÊñáÁ´†ÂÜÖÂÆπ -->
<div class="body-container">
  <article class="content-container layout-block post-container">
    <div class="article-info">
      
      
      
      
      <link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">
      <script src="//unpkg.com/heti/umd/heti-addon.min.js"></script>
      <section class="article-entry markdown-body layout-margin content-padding--large soft-size--large soft-style--box">
        <article class="heti heti--sans">
          <style>
            .heti {
              max-width: 100%;
              line-height: 1.5em;
            }
            figure.highlight { text-align: left; }
            .heti figure table { border-width: 0px; }
            .heti blockquote {
              background-color: transparent;
              padding-block-start: 0px;
              padding-block-end: 0px;
            }
            .heti--vertical {
              overflow-x: scroll;
            }
            .heti-em {
              text-emphasis: filled circle;
              text-emphasis-position: under;
            }
            </style>
            <script>
              const heti = new Heti('.heti');
              heti.autoSpacing();
            </script>
          <h1 id="The-Problem"><a href="#The-Problem" class="headerlink" title="The Problem"></a>The Problem</h1><p>This post is talking about a ‚Äúweird‚Äù <a target="_blank" rel="noopener" href="https://github.com/GreptimeTeam/greptimedb/issues/350">problem</a> we encountered in <a target="_blank" rel="noopener" href="https://github.com/GreptimeTeam/greptimedb">GreptimeDB</a>. And, a little spoiler, it‚Äôs about the ‚Äúasync cancellation‚Äù.</p>
<p>Let‚Äôs first describe the (simplified) scenario. We observed metadata corruption in a long-run test. A series number is duplicated, but it should be increased monotonously. The update logic is very straightforward ‚Äì load value from an in-memory atomic counter, persist the new series number to file, and then update the in-memory counter. The entire procedure is serialized (<code>file</code> is a mutable reference):</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">update_metadata</span></span>(file: &amp;<span class="hljs-keyword">mut</span> File, counter: AtomicU64) -&gt; <span class="hljs-built_in">Result</span>&lt;()&gt; &#123;<br>    <span class="hljs-keyword">let</span> next_number = counter.load(Ordering::Relaxed) + <span class="hljs-number">1</span>;<br>    persist_number(file, number).<span class="hljs-keyword">await</span>?;<br>    counter.fetch_add(<span class="hljs-number">1</span>, Ordering::Relaxed);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>For some reason, we are not using <code>fetch_add</code> here, though it does work, and if we‚Äôve done so, then the story won‚Äôt happen ü§™ For example, we don‚Äôt want to update the in-memory counter when this procedure fails halfway, like operation <code>persist_number()</code> cannot write to the file. Here the sweet sugar <code>?</code> stands for such a situation. We know clearly that this function call may fail, and if it fails the caller returns early to propagate the error. So we will handle it carefully with that in mind.</p>
<p>But things become tricky with <code>.await</code>, the hidden control flow comes due to async cancellation.</p>
<h1 id="Async-Cancellation"><a href="#Async-Cancellation" class="headerlink" title="Async Cancellation"></a>Async Cancellation</h1><h2 id="async-task-and-runtime"><a href="#async-task-and-runtime" class="headerlink" title="async task and runtime"></a>async task and runtime</h2><p>If you have figured out the shape of the ‚Äúcriminal‚Äù, you may want to skip this section. Instead, I‚Äôll start with some pseudocode to show what happens in the ‚Äúawait point‚Äù, and how it interacts with the runtime. First is <code>poll_future</code>, it comes from the <code>Future</code>‚Äòs <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/std/future/trait.Future.html#tymethod.poll"><code>poll</code></a> function, as every <code>async fn</code>‚Äòs we write will be desugared to an anonymous <code>Future</code> implementation.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">poll_future</span></span>() -&gt; FutureOutput &#123;<br>    <span class="hljs-keyword">match</span> status_of_the_task &#123;<br>        Ready(output) =&gt; &#123;<br>            <span class="hljs-comment">// the task is finished, and we have it output.</span><br>            <span class="hljs-comment">// some logic</span><br>            <span class="hljs-keyword">return</span> our_output;<br>        &#125;,<br>        Pending =&gt; &#123;<br>            <span class="hljs-comment">// it is not ready, we don&#x27;t have the output.</span><br>            <span class="hljs-comment">// thus we cannot make progress and need to wait</span><br>            <span class="hljs-keyword">return</span> Pending;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>async</code> block usually contains other async functions, like <code>update_metadata</code> and <code>persist_number</code>. Say <code>persist_number</code> is a sub-async-task of <code>update_metadata</code>. Each <code>.await</code> point will be expanded to something like <code>poll_future</code> ‚Äì <code>await</code>ing the subtask‚Äôs output and make progress when the subtask is ready. Here we need to wait <code>persist_number</code>‚Äòs task returns <code>Ready</code> before we update the counter, otherwise we cannot do it.</p>
<p>And the second one is a (toy) runtime, which is in response to poll futures delivered to it. In GreptimeDB we use <a target="_blank" rel="noopener" href="https://docs.rs/tokio/latest/tokio/"><code>tokio</code></a> as our runtime. An async runtime may have tons of features and logic, but the most basic one is to poll: as the name tells, keep running unfinished tasks until they finish (but consider the things I‚Äôm going to write later, the ‚Äúuntil‚Äù might not be a proper word).</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">runtime</span></span>(&amp;<span class="hljs-keyword">self</span>) &#123;<br>    <span class="hljs-keyword">loop</span> &#123;<br>        <span class="hljs-keyword">let</span> future_tasks: <span class="hljs-built_in">Vec</span>&lt;Task&gt; = <span class="hljs-keyword">self</span>.get_tasks();<br>        <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> tasks &#123;<br>            <span class="hljs-keyword">match</span> task.poll_future()&#123;<br>                Ready(output) =&gt; &#123;<br>                    <span class="hljs-comment">// this task is finished. wake it with the result</span><br>                    task.wake(output);<br>                &#125;,<br>                Pending =&gt; &#123;<br>                    <span class="hljs-comment">// this task needs some time to run. poll it later</span><br>                    <span class="hljs-keyword">self</span>.poll_later(task);<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>That is it, a very minimalist model of future and runtime. Combining these two functions, you will find that in some aspects, it is just a loop (again, I‚Äôve omitted lots of details to keep tight on the topic; the real world is way more complex). I want to stress the thing that each <code>.await</code> imply one or more function calls (call to <code>poll()</code> or <code>poll_future()</code>). This is the ‚Äúhidden control flow‚Äù in the title and the place cancellation takes effort.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">run</span></span>() &#123;<br>    <span class="hljs-keyword">loop</span> &#123;<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> Ready(result) = task.poll() &#123;<br>            <span class="hljs-keyword">break</span> result;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>Know it is not hard, but thinking about it is not easy (at least for me). I‚Äôve stared at these lines for minutes after I narrow the scope down to as simple as the first code snippet. I know the problem is definitely in the <code>.await</code>. But don‚Äôt know whether too many successful async calls have numbed me or my mental model hasn‚Äôt linked these two points. The bulky garbage, me, spent a whole sleepless night doubting life and the world.</p>
<h2 id="cancellation"><a href="#cancellation" class="headerlink" title="cancellation"></a>cancellation</h2><p>So far is the standard part. We will then talk about cancellation, which is runtime-dependent. Though many runtimes in rust have similar behavior, this is not a required feature, i.e., a runtime can not support cancellation at all like <a target="_blank" rel="noopener" href="https://github.com/waynexia/texn">this toy</a>. And I‚Äôll take tokio as an example because the story happens there. Other runtimes may be similar.</p>
<p>In tokio, one can use <a target="_blank" rel="noopener" href="https://docs.rs/tokio/latest/tokio/task/struct.JoinHandle.html#method.abort"><code>JoinHandle::abort()</code></a> to cancel a task. Tasks have a ‚Äúcancel marker bit‚Äù tracks whether it‚Äôs cancelled. And if the runtime finds a task is cancelled, it will kill that task (code from <a target="_blank" rel="noopener" href="https://github.com/tokio-rs/tokio/blob/00bf5ee8a855c28324fa4dff3abf11ba9f562a85/tokio/src/runtime/task/state.rs#L283-L291">here</a>):</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">// If the task is running, we mark it as cancelled. The thread</span><br><span class="hljs-comment">// running the task will notice the cancelled bit when it</span><br><span class="hljs-comment">// stops polling and it will kill the task.</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// The set_notified() call is not strictly necessary but it will</span><br><span class="hljs-comment">// in some cases let a wake_by_ref call return without having</span><br><span class="hljs-comment">// to perform a compare_exchange.</span><br>snapshot.set_notified();<br>snapshot.set_cancelled();<br></code></pre></td></tr></table></figure>

<p>The theory behind async cancellation is also elementary. It‚Äôs just the runtime gives up to keep polling your task when it‚Äôs not yet finished, just like <code>?</code> or even tougher because we cannot catch this cancellation like <code>Err</code>. But does it means that we need to take care of every single <code>.await</code>? It would be very annoying. Take this metadata updating as an example. If we have to consider this, we need to check if the file is consistent with the memory state and revert the persisted change if found inconsistency. Well‚Ä¶ ü´† In some aspects, yes. The runtime can literally do anything to your future. But the good thing is that most of them are disciplined.</p>
<h1 id="Runtime-Behavior"><a href="#Runtime-Behavior" class="headerlink" title="Runtime Behavior"></a>Runtime Behavior</h1><p>This section will discuss what I would expect from a runtime and what we can get for now.</p>
<h2 id="marker-trait"><a href="#marker-trait" class="headerlink" title="marker trait"></a>marker trait</h2><p>I want the runtime not to cancel my task unconditionally and turn to the type system for help. This is wondering if there is a marker trait like <code>CancelSafe</code>. For the word cancellation safety, tokio has said about it in its <a target="_blank" rel="noopener" href="https://docs.rs/tokio/latest/tokio/macro.select.html#cancellation-safety">documentation</a>:</p>
<blockquote>
<p>To determine whether your own methods are cancellation safe, look for the location of uses of  <code>.await</code> . This is because when an asynchronous method is cancelled, that always happens at an  <code>.await</code> . If your function behaves correctly even if it is restarted while waiting at an  <code>.await</code> , then it is cancellation safe.  </p>
</blockquote>
<p>That is, whether a task is safe to be cancelled. This is definitely an ‚Äúattribute‚Äù of an async task. You can find that tokio has a long list of what is safe and what isn‚Äôt in the library from the above link. And, in some ways, I think it‚Äôs just like the <a href="jhttps://doc.rust-lang.org/std/panic/trait.UnwindSafe.html"><code>UnwindSafe</code></a> marker. Both are ‚Äú<em>this sort of control flow is not always anticipated</em>‚Äú and ‚Äú<em>has the possibility of causing subtle bugs</em>‚Äú.</p>
<p>With such a <code>CancelSafe</code> trait, we can tell the runtime if our spawned future is ok to be cancelled, and we promise the ‚Äúcancelling‚Äù control flow is carefully handled. And if without this, means we don‚Äôt want the task to be cancelled. Simple and clear. This is also an approach for the runtimes to require their users (like you and me) to check if their tasks are able to be cancelled. Take <code>timeout()</code> as an example:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-comment">/// The marker trait</span><br><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">CancelSafe</span></span> &#123;&#125;<br><br><span class="hljs-comment">/// Only cancellable task can be timeout-ed</span><br><span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">timeout</span></span>&lt;F&gt;(duration: Duration, future: F) -&gt; Timeout&lt;F&gt; <span class="hljs-keyword">where</span><br>    F: Future + CancelSafe<br>&#123;&#125;<br></code></pre></td></tr></table></figure>

<h2 id="volunteer-cancel"><a href="#volunteer-cancel" class="headerlink" title="volunteer cancel"></a>volunteer cancel</h2><p>Another approach is to cancel voluntarily. Like the <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/cancellation-and-timeouts.html#cancellation-is-cooperative">cooperative cancellation in Kotlin</a>, it has an <a target="_blank" rel="noopener" href="https://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/is-active.html"><code>isActive</code></a> method for a task to check if it is cancelled. And this is only a tester method, to cancel or not is fully dependent on the task itself. I paste an example from Kotlin‚Äôs document below, the ‚Äúcooperative cancellation‚Äù happens in line 5. This way brings the ‚Äúhidden control flow‚Äù on the table and makes it more natural to consider and handle the cancellation just like <code>Option</code> or <code>Result</code>.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> startTime = System.currentTimeMillis()<br><span class="hljs-keyword">val</span> job = launch(Dispatchers.Default) &#123;<br>    <span class="hljs-keyword">var</span> nextPrintTime = startTime<br>    <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> (isActive) &#123; <span class="hljs-comment">// cancellable computation loop</span><br>        <span class="hljs-comment">// print a message twice a second</span><br>        <span class="hljs-keyword">if</span> (System.currentTimeMillis() &gt;= nextPrintTime) &#123;<br>            println(<span class="hljs-string">&quot;job: I&#x27;m sleeping <span class="hljs-subst">$&#123;i++&#125;</span> ...&quot;</span>)<br>            nextPrintTime += <span class="hljs-number">500L</span><br>        &#125;<br>    &#125;<br>&#125;<br>delay(<span class="hljs-number">1300L</span>) <span class="hljs-comment">// delay a bit</span><br>println(<span class="hljs-string">&quot;main: I&#x27;m tired of waiting!&quot;</span>)<br>job.cancelAndJoin() <span class="hljs-comment">// cancels the job and waits for its completion</span><br>println(<span class="hljs-string">&quot;main: Now I can quit.&quot;</span>)<br></code></pre></td></tr></table></figure>

<p>And this is not hard to achieve in my opinion. Tokio already has the <a target="_blank" rel="noopener" href="https://github.com/tokio-rs/tokio/blob/00bf5ee8a855c28324fa4dff3abf11ba9f562a85/tokio/src/runtime/task/state.rs#L41"><code>Cancelled</code> bit</a> and <a target="_blank" rel="noopener" href="https://docs.rs/tokio-util/latest/tokio_util/sync/struct.CancellationToken.html"><code>CancellationToken</code></a>. But they look a bit different than what I describe. And after all of these, we need runtime to give the cancellation right back to our task. Or the situation might not have big difference.</p>
<h2 id="explicit-detach"><a href="#explicit-detach" class="headerlink" title="explicit detach"></a>explicit detach</h2><p>Can we force the runtime not to cancel our tasks at present? In tokio we can ‚Äúdetach‚Äù a task to the background by dropping the <code>JoinHandle</code>. A detached task means there is no foreground handle to the spawned task, and in some aspect, others cannot wrap a <code>timeout</code> or <code>select</code> over it, making it un-cancellable. And the problem in the very beginning is solved in this way.</p>
<blockquote>
<p>A  <code>JoinHandle</code>  <em>detaches</em> the associated task when it is dropped, which means that there is no longer any handle to the task, and no way to  <code>join</code> on it.  </p>
</blockquote>
<p>Though there is the functionality, I would wonder if it‚Äôs better to have an explicit <code>detach</code> method like <a target="_blank" rel="noopener" href="https://docs.rs/glommio/0.7.0/glommio/struct.Task.html#method.detach"><code>glommio&#39;s</code></a>, or even a <code>detach</code> method in the runtime like <code>spawn</code>, which doesn‚Äôt return the <code>JoinHandle</code>. But these are trifles. A runtime usually won‚Äôt cancel a task for no reason, and in most cases, it‚Äôs required by the users. But sometimes you haven‚Äôt noticed that, like those ‚Äúunselect branches‚Äù in <code>select</code>, or the logic in <code>tonic</code>‚Äòs request handler. And if we are sure that a task is ready for cancellation, explicit detach may prevent it from tragedy sometime.</p>
<h1 id="Back-To-The-Problem"><a href="#Back-To-The-Problem" class="headerlink" title="Back To The Problem"></a>Back To The Problem</h1><p>So far everything is clear. Let‚Äôs start to wipe out this bug! First is, why our future is cancelled? Through the function call graph we can easily find the entire process procedure is executed in-place in <code>tonic</code>‚Äòs request licensing runtime, and it‚Äôs common for an internet request to have a timeout behavior. And the solution is also simple, just detaching the server processing logic into another runtime to prevent it from cancelled with the request. Only <a target="_blank" rel="noopener" href="https://github.com/GreptimeTeam/greptimedb/pull/376/files#diff-9756dcef86f5ba1d60e01e41bf73c65f72039f9aaa057ffd03f3fc2f7dadfbd0R46-R54">a few lines</a>:</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-meta">@@ -30,12 +40,24 @@</span> impl BatchHandler &#123;<br>         &#125;<br>         batch_resp.admins.push(admin_resp);<br><br><span class="hljs-deletion">-        for db_req in batch_req.databases &#123;</span><br><span class="hljs-deletion">-            for obj_expr in db_req.exprs &#123;</span><br><span class="hljs-deletion">-                let object_resp = self.query_handler.do_query(obj_expr).await?;</span><br><span class="hljs-deletion">-                db_resp.results.push(object_resp);</span><br><span class="hljs-addition">+        let (tx, rx) = oneshot::channel();</span><br><span class="hljs-addition">+        let query_handler = self.query_handler.clone();</span><br><span class="hljs-addition">+        let _ = self.runtime.spawn(async move &#123;</span><br><span class="hljs-addition">+            // execute request in another runtime to prevent the execution from being cancelled unexpected by tonic runtime.</span><br><span class="hljs-addition">+            let mut result = vec![];</span><br><span class="hljs-addition">+            for db_req in batch_req.databases &#123;</span><br><span class="hljs-addition">+                for obj_expr in db_req.exprs &#123;</span><br><span class="hljs-addition">+                    let object_resp = query_handler.do_query(obj_expr).await;</span><br><span class="hljs-addition">+</span><br><span class="hljs-addition">+                    result.push(object_resp);</span><br><span class="hljs-addition">+                &#125;</span><br>             &#125;<br></code></pre></td></tr></table></figure>

<p>Now all fine.</p>

        </article>
      </section>

      
      
        <nav class="article-nav">
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
    <div class="card-text">
      
        <a href="/2022/12/async-cancellation-zh/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">Áúã‰∏çËßÅÁöÑÊéßÂà∂ÊµÅ</h2>
        </a>
      
      <div class="card-text--row">Newer</div>
    </div>
  </article>
</div>
          
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
    <div class="card-text">
      
        <a href="/2022/09/curp-notes/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">Paper Reading: CURP protocol</h2>
        </a>
      
      <div class="card-text--row">Older</div>
    </div>
  </article>
</div>
          
        </nav>
      

      <section class="page-message-container layout-padding">
        


  
  

  
  


      </section>
    </div>
    <div class="widget-info">
      <section class="widget-author widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-body">
    
      <img src="https://github.com/waynexia.png" class="soft-size--round soft-style--box" alt="Wayne">
    
    
      <h2>Wayne</h2>
    
    

    <!-- <div class="count-box">
      <div class="count-box--item">
        <svg class="icon icon-article" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M240.51564747 647.74217627h196.07203239c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806V165.10332731c0-33.18142087-30.16492806-60.32985613-60.32985612-60.32985611H245.04038668C225.43318342 104.7734712 210.35071939 119.85593522 210.35071939 139.46313845V617.57724821c0 16.59071043 13.57421762 30.16492806 30.16492808 30.16492806z m663.62841731-452.47392089v482.63884894c0 33.18142087-27.14843525 60.32985613-60.32985612 60.32985613H180.18579134c-33.18142087 0-60.32985613-27.14843525-60.32985612-60.32985613V195.26825538c-49.77213131 0-90.49478418 40.72265287-90.49478417 90.49478417v452.4739209c0 49.77213131 40.72265287 90.49478418 90.49478417 90.49478417h286.56681657c16.59071043 0 30.16492806 13.57421762 30.16492807 30.16492807s13.57421762 30.16492806 30.16492805 30.16492806h90.49478418c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806s13.57421762-30.16492806 30.16492807-30.16492807h286.56681657c49.77213131 0 90.49478418-40.72265287 90.49478417-90.49478417V285.76303955c0-49.77213131-40.72265287-90.49478418-90.49478417-90.49478417zM587.41232014 647.74217627h191.54729318c19.60720323 0 34.68966726-15.08246403 34.68966729-34.68966727V134.93839925c0-16.59071043-13.57421762-30.16492806-30.16492808-30.16492805H617.57724821c-30.16492806 0-60.32985613 27.14843525-60.32985612 60.32985611v452.4739209c0 16.59071043 13.57421762 30.16492806 30.16492805 30.16492806z" fill="currentColor"></path>
</svg>
        <span>18</span>
      </div>
      <div class="count-box--item">
        <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
        0
      </div>
      <div class="count-box--item">
        <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
        6
      </div>
    </div> -->

    
    <div class="social-icons">
      
        
      
        
      
        
      
        
          <a href="https://github.com/waynexia/" class="soft-size--primary" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
</svg>
          </a>
        
      
        
          <a href="https://twitter.com/wayne17229928" class="soft-size--primary" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-twitter" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M962.285714 233.142857q-38.285714 56-92.571429 95.428571 0.571429 8 0.571429 24 0 74.285714-21.714286 148.285714t-66 142-105.428571 120.285714-147.428571 83.428571-184.571429 31.142857q-154.857143 0-283.428571-82.857143 20 2.285714 44.571429 2.285714 128.571429 0 229.142857-78.857143-60-1.142857-107.428571-36.857143t-65.142857-91.142857q18.857143 2.857143 34.857143 2.857143 24.571429 0 48.571429-6.285714-64-13.142857-106-63.714286t-42-117.428571l0-2.285714q38.857143 21.714286 83.428571 23.428571-37.714286-25.142857-60-65.714286t-22.285714-88q0-50.285714 25.142857-93.142857 69.142857 85.142857 168.285714 136.285714t212.285714 56.857143q-4.571429-21.714286-4.571429-42.285714 0-76.571429 54-130.571429t130.571429-54q80 0 134.857143 58.285714 62.285714-12 117.142857-44.571429-21.142857 65.714286-81.142857 101.714286 53.142857-5.714286 106.285714-28.571429z"></path>
</svg>
          </a>
        
      
        
          <a href="https://twitter.com/wayne17229928" class="soft-size--primary" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-mastodon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
  <path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path>
</svg>

          </a>
        
      
      
        <a rel="alternate" href="/atom.xml" title="Wonderland" type="application/atom+xml">
          <svg class="icon icon-rss" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path>
</svg>
        </a>
      
    </div>
     
    
  </div>
</section>

      <!--  -->

      <!-- <section class="widget-categorys widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
    <span>CATEGORYS</span>
  </div>
  <div class="widget-body">
    <ul class="categorys-list">
      
    </ul>
  </div>
</section> -->

      <section class="widget-tags widget-item  layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
    <span>Tags</span>
  </div>
  <div class="widget-body">
    <div class="tags-cloud">
      <!-- <a href="/tags/Device/" style="font-size: 10px;" class="tags-cloud-0">Device</a> <a href="/tags/Experience/" style="font-size: 20px;" class="tags-cloud-10">Experience</a> <a href="/tags/Game/" style="font-size: 16.67px;" class="tags-cloud-7">Game</a> <a href="/tags/Paper-Reading/" style="font-size: 13.33px;" class="tags-cloud-3">Paper Reading</a> <a href="/tags/Rust/" style="font-size: 20px;" class="tags-cloud-10">Rust</a> <a href="/tags/Slides/" style="font-size: 13.33px;" class="tags-cloud-3">Slides</a> -->
      
          <a href="/tags/Paper-Reading/">
            Paper Reading (2)
          </a>
      
          <a href="/tags/Rust/">
            Rust (5)
          </a>
      
          <a href="/tags/Slides/">
            Slides (2)
          </a>
      
          <a href="/tags/Experience/">
            Experience (5)
          </a>
      
          <a href="/tags/Game/">
            Game (3)
          </a>
      
          <a href="/tags/Device/">
            Device (1)
          </a>
      
    </div>
  </div>
</section>

      <!-- todo: only sticky TOC list -->
      
<section class="widget-toc widget-item layout-margin content-padding--primary soft-size--large soft-style--box sticky_element">
  <div class="widget-title">
    <svg class="icon icon-toc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M134.50666666 767.46666668H460.8c27.73333333 0 50.24000001 22.50666668 50.24000001 50.23999999v50.13333333c0 27.73333333-22.50666668 50.24000001-50.24000001 50.24000001H134.50666666c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.24000001v-50.13333333c0.10666668-27.73333333 22.50666668-50.24000001 50.24000001-50.24000001zM84.37333332 541.65333333h326.18666669c27.73333333 0 50.24000001 22.39999999 50.23999999 50.13333334v50.24000001c0 27.73333333-22.50666668 50.24000001-50.24000002 50.23999999H84.37333332c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.23999999v-50.24000001c0-27.73333333 22.50666668-50.13333334 50.24000001-50.13333334zM134.50666666 315.83999999H460.8c27.73333333 0 50.24000001 22.50666668 50.24000001 50.24000001v50.24000001c0 27.73333333-22.50666668 50.13333334-50.24000001 50.13333333H134.50666666c-27.73333333 0-50.24000001-22.39999999-50.23999999-50.13333333v-50.24000001c0.10666668-27.84000001 22.50666668-50.24000001 50.24000001-50.23999999zM209.81333332 89.91999999h326.18666671c27.73333333 0 50.24000001 22.39999999 50.23999997 50.13333335v50.23999999c0 27.73333333-22.50666668 50.24000001-50.24000001 50.24000001H209.81333332c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.24000001v-50.24000001c0-27.73333333 22.50666668-50.13333334 50.24000001-50.13333333zM692.05333333 623.36l274.66666669 176.00000002c23.36000001 14.93333333 30.08 45.97333334 15.14666666 69.33333332L954.77333334 910.93333333c-14.93333333 23.25333334-45.97333334 30.08-69.33333335 15.14666667l-274.66666666-176c-23.36000001-14.93333333-30.08-45.97333334-15.14666667-69.33333333l27.09333334-42.24000001c14.93333333-23.36000001 46.08000001-30.08 69.33333333-15.14666666z" fill="currentColor"></path>
</svg>
    <span>Content</span>
  </div>
  <div class="widget-body">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Problem"><span class="toc-text">The Problem</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Async-Cancellation"><span class="toc-text">Async Cancellation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#async-task-and-runtime"><span class="toc-text">async task and runtime</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cancellation"><span class="toc-text">cancellation</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Runtime-Behavior"><span class="toc-text">Runtime Behavior</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#marker-trait"><span class="toc-text">marker trait</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#volunteer-cancel"><span class="toc-text">volunteer cancel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explicit-detach"><span class="toc-text">explicit detach</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Back-To-The-Problem"><span class="toc-text">Back To The Problem</span></a></li></ol>
  </div>
</section>


    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    <p>
      &copy; 2025 <a href="/" target="_blank">Wayne</a>
      
        |
        <a rel="alternate" href="/atom.xml" title="Wonderland" type="application/atom+xml">
          <svg class="icon icon-rss" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path>
</svg>
        </a>
      
    </p>

    

    <p>Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a> - <a href="https://github.com/waynexia/flexblock-modified" target="_blank" rel="noopener noreferrer author">This theme</a> is customized from <a href="https://github.com/miiiku/flex-block" target="_blank" rel="noopener noreferrer author">flex-block</a></p>

    <script data-goatcounter="https://waynest.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

  </div>
</footer>
  </div>

  <div class="back-to-top-fixed soft-size--round soft-style--box">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
      <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
      <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
    </svg>
  </div>

  
  <!-- aplayer -->


<!-- dplayer -->




  


  


  




<script src="/js/script.js"></script>


  
  <!-- Â∞æÈÉ®Áî®Êà∑Ëá™ÂÆö‰πâÁõ∏ÂÖ≥ÂÜÖÂÆπ -->
</body>
</html>