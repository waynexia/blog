<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="theme-color" content="#3367D6"/>
  <link rel="apple-touch-icon" href="/icons-192.png">
  <link rel="manifest" href="/manifest.json">
  
  <meta name="generator" content="Hexo 6.0.0">

  
    <meta name="description" content="Wayne&#39;s personal blog">
  

  

  
    <meta name="author" content="Wayne">
  

  

  

  <title>VictoriaLogs Source Reading | Wonderland</title>

  
    <link rel="alternate" href="/atom.xml" title="Wonderland" type="application/atom+xml">
  

  
    <link rel="shortcut icon" href="/favicon.ico">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@1.1.3/index.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/styles/monokai.css">
  

  
<link rel="stylesheet" href="/css/style.css">

</head>
<body>
  <div class="root-container">
    
<!-- header container -->
<header class="header-container post">
  
    <div class="post-image" style="background-image: url(https://raw.githubusercontent.com/waynexia/flexblock-modified/main/source/89433360_p0.jpg)"></div>
  

  <!-- navbar -->
<nav class="navbar">
  <div class="navbar-content">
    <!-- logo -->
    <div class="navbar-logo">
      <a href="/">
        
          Wonderland
        
      </a>
    </div>
    <!-- link -->
    <div class="navbar-link">
      <div class="navbar-btn">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <ul class="navbar-list">
        
          <li class="navbar-list-item"><a href="/">Home</a></li>
        
          <li class="navbar-list-item"><a href="/about">About</a></li>
        

        <li class="navbar-list-item">|</li>

        <li class="navbar-list-item"><a href="javascript:;" id="theme-light">üåû Light</a></li>
        <li class="navbar-list-item"><a href="javascript:;" id="theme-dark">üåõ Dark</a></li>
        <li class="navbar-list-item"><a href="javascript:;" id="theme-auto">üåó Auto</a></li>
      </ul>
    </div>
  </div>
</nav>

  
  

  
  

  
  

  
  

  
  
    <div class="header-content">
      <div class="post-text layout-block">
        <div class="layout-margin">
          <h1 class="title-wrap">VictoriaLogs Source Reading</h1>
          <h2 class="title-sub-wrap">
            <strong>Wayne</strong>
            <span>write on</span>
            <time  class="article-date" datetime="2025-01-06T21:20:17.000Z" itemprop="datePublished">2025-01-06</time>
          </h2>
          <ul class="wrap-list dark">
  
</ul>
          <ul class="wrap-list dark">
  
</ul>
        </div>
      </div>
    </div>
  

  
  
  
</header>

    <!-- ÊñáÁ´† -->

<!-- ÊñáÁ´†ÂÜÖÂÆπ -->
<div class="body-container">
  <article class="content-container layout-block post-container">
    <div class="article-info">
      
      
      
      
      <link rel="stylesheet" href="//unpkg.com/heti/umd/heti.min.css">
      <script src="//unpkg.com/heti/umd/heti-addon.min.js"></script>
      <section class="article-entry markdown-body layout-margin content-padding--large soft-size--large soft-style--box">
        <article class="heti heti--sans">
          <style>
            .heti {
              max-width: 100%;
              line-height: 1.5em;
            }
            figure.highlight { text-align: left; }
            .heti figure table { border-width: 0px; }
            .heti blockquote {
              background-color: transparent;
              padding-block-start: 0px;
              padding-block-end: 0px;
            }
            .heti--vertical {
              overflow-x: scroll;
            }
            .heti-em {
              text-emphasis: filled circle;
              text-emphasis-position: under;
            }
            </style>
            <script>
              const heti = new Heti('.heti');
              heti.autoSpacing();
            </script>
          <h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>VictoriaLogs is a new and prominent player in the log management sector. Developed by the same team behind VictoriaMetrics, the code is not built on top of VictoriaMetrics. Compared to its competitors, VictoriaLogs is more lightweight: one of the key differentiators for VictoriaLogs is its architectural design and usage. It can be used as a standalone log management system or as a command line tool similar to <code>grep</code>. On the query interface, it has proposed a new DSL named <code>LogsQL</code> which generally follows a pipe style.</p>
<p>This project is relatively ‚Äúyoung‚Äù, and a major part of the codebase is from an ‚Äúinitial‚Äù <a target="_blank" rel="noopener" href="https://github.com/VictoriaMetrics/VictoriaMetrics/commit/87b66db47da23cb9fe800ce16efa6bdac365f5a8">patch</a>. The team is and likely will be mainly focusing on the storage (database) part akin to VictoriaMetrics. At the time of writing, there are two ways to visualize the logs: Grafana data source <a target="_blank" rel="noopener" href="https://github.com/VictoriaMetrics/victorialogs-datasource/">plugin</a> (not available in the plugin store) and a built-in UI. It plans to support cluster mode in early 2025.</p>
<p><em>Fun fact: VictoriaLogs seems to be proposed by a community contributor. Here is the <a target="_blank" rel="noopener" href="https://github.com/VictoriaMetrics/VictoriaMetrics/issues/816">original list</a> (back to Oct. 2020)</em></p>
<p>This blog is based on commit <code>e0b2c1c4f5b68070c8945c587e17d6e9415c48b5</code>, Tue Dec 24.</p>
<h2 id="Code-line-count"><a href="#Code-line-count" class="headerlink" title="Code line count"></a>Code line count</h2><p>Before diving in, let‚Äôs have a quick look at the repository. Both VictoriaLogs and VictoriaMetrics, as well as other related projects like agent or alert services, are placed in one main <a target="_blank" rel="noopener" href="https://github.com/VictoriaMetrics/VictoriaMetrics/">repository</a>.</p>
<p>Pie charts of the code line count:</p>
<div class="heti heti--columns-2">


    <figure class="figure-image">
      <img src="line-of-repo.svg" alt="Line count of the repository" width="100%" height="100% loading="lazy" />
      <figcaption>Line count of the repository</figcaption>
    </figure>
  


    <figure class="figure-image">
      <img src="line-of-logstorage.svg" alt="Line count of logstorage package" width="100%" height="100% loading="lazy" />
      <figcaption>Line count of logstorage package</figcaption>
    </figure>
  

</div>

<p>From the above charts, we can see that the logstorage package is nearly 1/4 of this project. To clarify, the logstorage package doesn‚Äôt reuse much code from VictoriaMetrics; basic components like <code>block</code>, <code>indexdb</code>, etc., are duplicated with slight differences. This, on the other hand, shows that the project is relatively independent and concise.</p>
<p>The <code>logstorage</code> package above is the major implementation of VictoriaLogs, including its query language, storage, index, etc. The second figure on the right side is a rough breakdown of <code>logstorage</code>. It‚Äôs composed of a few key components: <code>pipe</code>, <code>filter</code>, <code>stats</code>, <code>block</code>, <code>parser</code>, and so on. We will cover them in the following sections.</p>
<p>Another interesting finding is that in either the whole project level or in <code>logstorage</code>, the test code is about 1/2 of the normal logic. For example, inside <code>logstorage</code>, there are 33620 lines of test code among 73861 lines in total.</p>
<p>These two figures can give us a rough idea of the project structure and what might be the key components. Now let‚Äôs dive into the code implementation.</p>
<h1 id="Key-concepts"><a href="#Key-concepts" class="headerlink" title="Key concepts"></a>Key concepts</h1><p>Firstly, there are some key concepts and their relations in VictoriaLogs (referred to as <code>logstorage</code> later on) that I came across many times. Some of them are exposed to the user, while others are internal:</p>
<ul>
<li>Data Model:<ul>
<li><strong>Stream</strong>: High-level representation of a group of log data (like a stream). Stream is used to group log entries logically.</li>
<li><strong>Block</strong>: Data representation within streams. A stream is divided into blocks for efficient storage and retrieval.</li>
<li><strong>Field</strong>: A field in log entries, like the column of data. Fields can be further divided into ‚ÄúMessage Field‚Äù, ‚ÄúTime Field‚Äù and ‚ÄúStream Field‚Äù.</li>
</ul>
</li>
</ul>

    <figure class="figure-image">
      <img src="data-model.svg" alt="Abstract data model of VictoriaLogs" width="70%" height="100% loading="lazy" />
      <figcaption>Abstract data model of VictoriaLogs</figcaption>
    </figure>
  

<div class="heti heti--columns-2">

<ul>
<li>Storage:<ul>
<li><strong>Partition</strong>: Data is partitioned by time range. Each partition is one day (<code>getPartitionForDay</code>). First level of organizing data (and index).</li>
<li><strong>DataDB</strong>: Stores log data in blocks. Works like an LSM tree.</li>
<li><strong>Part</strong>: Has <code>InMemoryPart</code> and <code>DiskPart</code>. <code>InMemoryPart</code> is like memtable and will be flushed to <code>DiskPart</code> when necessary.</li>
<li><strong>IndexDB</strong>: Manages indexing of log data. Based on <code>mergeset</code>.</li>
</ul>
</li>
</ul>
<p>Those ‚Äúwords‚Äù can be found in the file system. The following is an example file structure of VictoriaLogs‚Äô data directory ‚û°Ô∏è:</p>
<ul>
<li>Query:<ul>
<li><strong>Search</strong>: A query to logstorage is called ‚Äúsearch‚Äù.</li>
<li><strong>Tokenizer</strong>: Tokenize log entries for efficient searching and indexing.</li>
<li><strong>Filter</strong>: Various filters (e.g., time range, string match, regex) are used to narrow down log entries.</li>
<li><strong>Pipe</strong>: Advanced processing after filtering.</li>
<li><strong>BloomFilter</strong>: Helps quickly check the existence of log entries to accelerate queries.</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">‚ùØ ll -T victoria-logs-data<br><br>Size Name<br>   - victoria-logs-data<br>   0 ‚îú‚îÄ‚îÄ flock.lock<br>   - ‚îî‚îÄ‚îÄ partitions<br>   -     ‚îî‚îÄ‚îÄ 20250113<br>   -         ‚îú‚îÄ‚îÄ datadb<br>   -         ‚îÇ   ‚îú‚îÄ‚îÄ 181A232DC5D34F7D<br> 48M         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bloom.bin0<br> 48M         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bloom.bin1<br>  54         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ column_names.bin<br>736k         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ columns_header.bin<br> 78k         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ columns_header_index.bin<br>136k         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.bin<br>   0         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message_bloom.bin<br>   0         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message_values.bin<br> 250         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metadata.json<br> 110         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metaindex.bin<br> 21M         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ timestamps.bin<br>110M         ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ values.bin0<br>437M         ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ values.bin1<br> 210         ‚îÇ   ‚îî‚îÄ‚îÄ parts.json<br>   -         ‚îî‚îÄ‚îÄ indexdb<br>   -             ‚îú‚îÄ‚îÄ 181A232DC5CDBAB4<br>  52             ‚îÇ   ‚îú‚îÄ‚îÄ index.bin<br>  26             ‚îÇ   ‚îú‚îÄ‚îÄ items.bin<br>   8             ‚îÇ   ‚îú‚îÄ‚îÄ lens.bin<br> 163             ‚îÇ   ‚îú‚îÄ‚îÄ metadata.json<br>  51             ‚îÇ   ‚îî‚îÄ‚îÄ metaindex.bin<br>  20             ‚îî‚îÄ‚îÄ parts.json<br></code></pre></td></tr></table></figure>

</div>

<p>A LogsQL example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">_time:5m log.level:error -app:(buggy_app OR foobar) | delete host, app | stats count() errors<br></code></pre></td></tr></table></figure>

<ul>
<li>Utilities:<ul>
<li><strong>ChunkedAllocator</strong>: Allocates memory in chunks to reduce overhead.</li>
<li><strong>Encoding</strong>: Handles encoding and decoding of log data.</li>
<li><strong>Hasher</strong>: Provides hashing functions for log entries.</li>
<li><strong>Parser</strong>: Parses log entries and queries.</li>
</ul>
</li>
</ul>
<h1 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h1><p>In the storage part, we‚Äôll cover how the ingest request is handled, how the data is stored, and how to maintain related structures.</p>
<h2 id="Ingest"><a href="#Ingest" class="headerlink" title="Ingest"></a>Ingest</h2><p>The incoming log data is parsed to identify the tenant, stream tags, timestamp, etc. The log data is represented as the following:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// LogRows holds a set of rows needed for Storage.MustAddRows</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// LogRows must be obtained via GetLogRows()</span><br><span class="hljs-keyword">type</span> LogRows <span class="hljs-keyword">struct</span> &#123;<br>	streamIDs []streamID<br>	timestamps []<span class="hljs-keyword">int64</span><br>    <span class="hljs-comment">// Field is key-value pairs</span><br>	rows [][]Field<br><br>    <span class="hljs-comment">// streamFields contains names for stream fields</span><br>	streamFields <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">struct</span>&#123;&#125;<br>	<span class="hljs-comment">// ignoreFields contains names for log fields, which must be skipped during data ingestion</span><br>	ignoreFields <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">struct</span>&#123;&#125;<br>	<span class="hljs-comment">// extraFields contains extra fields to add to all the logs at MustAdd().</span><br>	extraFields []Field<br>	<span class="hljs-comment">// extraStreamFields contains extraFields, which must be treated as stream fields.</span><br>	extraStreamFields []Field<br><br>    <span class="hljs-comment">// ...omitted</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>streamID</code> is a unique identifier for a stream, and can be used to locate the stream in the indexdb or in filter by user. <code>streamID</code> is generated by hashing the stream tags and tenant id in <code>MustAdd</code> method. Technically, <code>streamID</code> can be generated outside of the VictoriaLogs.</p>
<p>Log rows are batched into an in-memory part that can‚Äôt be searched. Each <code>LogRows</code> will be converted to an <code>inmemoryPart</code>. Once the batch is large enough, or enough time has passed, a <code>block</code> is created and written to disk (<code>mustWriteTo</code>). <code>blockStreamWriter</code> is responsible for this, along with its associated index structures (<code>blockHeader</code>, etc.) and bloom filters.</p>
<p><code>indexdb</code> is updated to make sure every <code>streamID</code> is registered in the indexdb (via <code>mustRegisterStream</code>) so subsequent queries can locate the new data.</p>
<p>Periodically, these in-memory parts are merged and flushed to long-term storage for efficient querying. This is done by <code>datadb</code>.</p>

    <figure class="figure-image">
      <img src="ingest.svg" alt="Ingest process in VictoriaLogs" width="70%" height="100% loading="lazy" />
      <figcaption>Ingest process in VictoriaLogs</figcaption>
    </figure>
  

<p>Above is the rough process of handling ingest requests. On the protocol side, VictoriaLogs supports mainstream protocols like Grafana Loki, jsonline, Elasticsearch, OpenTelemetry, syslog, etc. Agents (log collector) like Fluent Bit, Logstash, Fluentd, and Vector can be used to send logs to VictoriaLogs.</p>
<h2 id="Storage-Block"><a href="#Storage-Block" class="headerlink" title="Storage - Block"></a>Storage - Block</h2><p><code>block</code> is the physical abstraction of log data. There is another ‚Äúblock‚Äù in <code>storage</code> which is similar to this one (as well as <code>indexdb</code>), but they are different structures. Like <code>block</code> in <code>logstorage</code> is used to store string log data, and the <code>indexdb</code> in <code>storage</code> doesn‚Äôt have a concept of ‚Äústream‚Äù. The hierarchy of related concepts is like this: <code>block</code> &lt;- <code>part</code> &lt;- <code>partition</code>.</p>
<p>Some basic information about <code>block</code>, many of them are inherited from <code>part</code>:</p>
<ul>
<li>Log entries from the same stream are packed together into the same blocks.</li>
<li>Each block contains columns covering unique field names across logs (horizontally partitioned).</li>
<li>Smaller blocks are automatically merged into bigger blocks in the background.</li>
<li><strong>Blocks exceeding size limits are split into multiple smaller blocks</strong>.</li>
<li>Partition: data is partitioned by time range.</li>
</ul>
<p>A block (in-memory representation) is simply defined as:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// block represents a block of log entries.</span><br><span class="hljs-keyword">type</span> block <span class="hljs-keyword">struct</span> &#123;<br>    <span class="hljs-comment">// timestamps contains timestamps for log entries.</span><br>    timestamps []<span class="hljs-keyword">int64</span><br>    <span class="hljs-comment">// columns contains values for fields seen in log entries.</span><br>    columns []column<br>    <span class="hljs-comment">// constColumns contains fields with constant values across all the block entries.</span><br>    constColumns []Field<br>&#125;<br></code></pre></td></tr></table></figure>

<p>On generating a block, the log entries are encoded and stored in file-system. In this step, some ‚Äúencoding‚Äù is applied:</p>
<ul>
<li>Data will be encoded using some specific types (integer, float, ipv4, timestamp). This is dynamically probed from log content.</li>
<li>String encoding is similar to Arrow BytesArray: a number array to record length, and a byte array to store the string content.</li>
<li>General compression like zstd is also applied on the marshaled binary data.</li>
</ul>
<p>Other structures like bloom filter, and index are also generated together and stored in the same directory.</p>
<h2 id="Storage-IndexDB"><a href="#Storage-IndexDB" class="headerlink" title="Storage - IndexDB"></a>Storage - IndexDB</h2><p>Victorialogs maintains an LSM (merge set) for stream metadata. Provides accurate point get and filter on stream id (akin to time-series).</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(idb *indexdb)</span> <span class="hljs-title">searchStreamIDs</span><span class="hljs-params">(tenantIDs []TenantID, sf *StreamFilter)</span> []<span class="hljs-title">streamID</span></span> &#123;&#125;<br></code></pre></td></tr></table></figure>

<p><code>StreamFilter</code> is a simple filter condition on tags (<code>_stream:&#123;...&#125;</code>).</p>
<!-- todo: some illustrate -->

<h2 id="Storage-Cache"><a href="#Storage-Cache" class="headerlink" title="Storage - Cache"></a>Storage - Cache</h2><!-- todo: less code and add one figure -->

<p><code>logstorage</code> maintains a very simple cache implementation to store <code>streamID</code>, and supports <code>filterStream</code> for quick access. <code>InMemoryParts</code> can also be treated as cache, but it‚Äôs more like a buffer for data from disk and we won‚Äôt cover them here.</p>
<p>The <code>cache</code> struct is a double-buffering map defined as follows:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> cache <span class="hljs-keyword">struct</span> &#123;<br>    curr atomic.Pointer[sync.Map]<br>    prev atomic.Pointer[sync.Map]<br>    stopCh <span class="hljs-keyword">chan</span> <span class="hljs-keyword">struct</span>&#123;&#125;<br>    wg     sync.WaitGroup<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>curr</code> &amp; <code>prev</code>: Atomic pointers to the cache (<code>sync.Map</code>).</li>
<li><code>stopCh</code> &amp; <code>wg</code>: for graceful shutdown (yes this cache is not just a pure ‚Äúalgorithm‚Äù)</li>
</ul>
<p>The system will periodically clean the cache to swap the current and previous caches. The <code>clean</code> method simply swaps the current and previous caches. I‚Äôm very curious about the performance of this implementation compared to the traditional LRU cache. I can almost assert it would be faster, but wondering by how much. I recall a <a target="_blank" rel="noopener" href="https://github.com/waynexia/texn/blob/master/src/dropmap.rs">similar thing</a> which is written for simplicity and performance.</p>
<p>On querying, it will first try to find in the <code>curr</code> cache, then the <code>prev</code> cache. And finally <code>indexdb</code> if the cache misses.</p>
<p>This <code>cache</code> is a small piece among caches. There are many other in-place caches in the system, like metadata of a block, bloom filter to evaluating filters etc. Those are also simply in-memory maps.</p>
<h1 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h1><div class="heti heti--columns-2">

<p>At a high level, its capabilities can be grouped into¬†<em>filters</em> (ways to locate logs of interest) and¬†<em>pipes</em> (ways to transform or process the results).</p>
<p><strong>Filters</strong>: These are building blocks for narrowing down log messages based on specific criteria (e.g., time ranges, word matches, field values). Filters include time filters, word/phrase/prefix filters, stream filters, range filters, etc.</p>
<p><strong>Pipes</strong>: Once filters have selected some logs, pipes let you transform or process these results. Some examples include:</p>
<ul>
<li><code>sort by (_time)</code> to reorder logs chronologically,</li>
<li><code>limit &lt;N&gt;</code> to retrieve only the top N results,</li>
<li><code>stats</code> to compute aggregate metrics like counts over the filtered logs.</li>
</ul>

    <figure class="figure-image">
      <img src="query.svg" alt="General query process" width="100%" height="100% loading="lazy" />
      <figcaption>General query process</figcaption>
    </figure>
  

</div>

<h2 id="Query-Filter"><a href="#Query-Filter" class="headerlink" title="Query - Filter"></a>Query - Filter</h2><p>There are various filter mechanisms to efficiently query and filter log entries.</p>

    <figure class="figure-image">
      <img src="filter.svg" alt="Filter in VictoriaLogs" width="70%" height="100% loading="lazy" />
      <figcaption>Filter in VictoriaLogs</figcaption>
    </figure>
  

<p>The interface is defined as follows:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// filter must implement filtering for log entries.</span><br><span class="hljs-keyword">type</span> filter <span class="hljs-keyword">interface</span> &#123;<br>    <span class="hljs-comment">// String returns string representation of the filter</span><br>    String() <span class="hljs-keyword">string</span><br>    <span class="hljs-comment">// udpdateNeededFields must update neededFields with fields needed for the filter</span><br>    updateNeededFields(neededFields fieldsSet)<br>    <span class="hljs-comment">// applyToBlockSearch must update bm according to the filter applied to the given bs block</span><br>    applyToBlockSearch(bs *blockSearch, bm *bitmap)<br>    <span class="hljs-comment">// applyToBlockResult must update bm according to the filter applied to the given br block</span><br>    applyToBlockResult(br *blockResult, bm *bitmap)<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>applyToBlockSearch</code> and <code>applyToBlockResult</code> have similar logic. On querying, filters are applied to stored data via <code>applyToBlockSearch</code>, which will generate an initial filter result. Then, if there is any pipe operation, <code>applyToBlockResult</code> may be called (based on the implementation) to do a post-filtering.</p>
<p>Filters work by first evaluating at block level with bloom filter to omit blocks quickly, then examining each log entries in one block and set the result to bitmap, which is used to indicate whether a log entry is matched or not.</p>
<h2 id="Query-Pipes"><a href="#Query-Pipes" class="headerlink" title="Query - Pipes"></a>Query - Pipes</h2><p>In LogsQL, an example using pipes is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">_time:5m error | sort by (_time) desc | limit 10 | stats count()<br></code></pre></td></tr></table></figure>

<p>Some key takeaways about Pipe:</p>
<ul>
<li>Run after all filters (except the <code>filter</code> pipe which can perform post-filtering)</li>
<li>Push mode in execution<ul>
<li>Filter ‚Äúpushes‚Äù result to pipe processors, at block level</li>
<li>Pipe processors ‚Äúpush‚Äù their intermediate result to the next pipe</li>
<li>Collect all data at the final collector.</li>
</ul>
</li>
<li>Interface<ul>
<li>Interfaces of <code>pipe</code> and <code>pipeProcessor</code> are very simple, and can be simplified to some kinds of function pointer.</li>
</ul>
</li>
</ul>
<p>Among various <code>pipe</code>s, the <code>stat</code> pipe is an exception in the aspect of complexity. It can be treated as the third major concept in log search, with the <code>pipe</code> type. It is some kind of ‚ÄúUDAF‚Äù for computing log entries. Common computation like <code>min()</code>, <code>count()</code>, <code>uniq()</code> (unique) or <code>quantile()</code> are supported out-of-the-box.</p>
<p>Both <code>pipe</code> and <code>stat</code> are easy to extend. A major part of query features will be implemented in these forms. Log queries usually don‚Äôt need complex computation or relation like in generic SQL, so this framework could cover a great part of the requirements.</p>
<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><ul>
<li>VictoriaLogs automatically transforms multi-level (nested) JSON into single-level JSON during data ingestion through a systematic flattening process<a target="_blank" rel="noopener" href="https://docs.victoriametrics.com/victorialogs/keyconcepts/">1</a>.</li>
<li>Nested dictionaries are flattened by joining keys with a dot (<code>.</code>) character. (e.g.: <code>host.os.version</code>)</li>
<li>Arrays, numbers, and boolean values are converted to strings.</li>
</ul>
<h2 id="Pool-anywhere"><a href="#Pool-anywhere" class="headerlink" title="Pool anywhere"></a>Pool anywhere</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">type</span> tokenizer <span class="hljs-keyword">struct</span> &#123;<br>    m <span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">struct</span>&#123;&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getTokenizer</span><span class="hljs-params">()</span> *<span class="hljs-title">tokenizer</span></span> &#123;<br>    v := tokenizerPool.Get()<br>    <span class="hljs-keyword">if</span> v == <span class="hljs-literal">nil</span> &#123;<br>        <span class="hljs-keyword">return</span> &amp;tokenizer&#123;<br>            m: <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-keyword">string</span>]<span class="hljs-keyword">struct</span>&#123;&#125;),<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> v.(*tokenizer)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">putTokenizer</span><span class="hljs-params">(t *tokenizer)</span></span> &#123;<br>    t.reset()<br>    tokenizerPool.Put(t)<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="Arena"><a href="#Arena" class="headerlink" title="Arena"></a>Arena</h2><p><code>arena</code> is used for efficient memory allocation, are cached to avoid the overhead of repeatedly creating and destroying these objects. In the major source of small allocation (query processing), <code>arena</code> is used among 13 pipe processors (30+ in total) and other misc structs like reader, intermediate result, codec, etc.</p>
<!-- 

todo: worker

# Product Level Review

## Great method is simple

## Searching with a better `grep`

## Compare with other log management systems -->

<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li>CTO‚Äôs overview slides about VL in 2023.05: <a target="_blank" rel="noopener" href="https://www.slideshare.net/slideshow/victorialogs-previewpdf/257033587">https://www.slideshare.net/slideshow/victorialogs-previewpdf/257033587</a></li>
<li>Repository: VictoriaMetrics‚Äô <a target="_blank" rel="noopener" href="https://github.com/VictoriaMetrics/VictoriaMetrics">main repository</a> and the <a target="_blank" rel="noopener" href="https://github.com/VictoriaMetrics/VictoriaMetrics/tree/master/lib/logstorage">logstorage dir</a></li>
<li>Key Concepts chapter from VictoriaLogs docs: <a target="_blank" rel="noopener" href="https://docs.victoriametrics.com/victorialogs/keyconcepts/">https://docs.victoriametrics.com/victorialogs/keyconcepts/</a></li>
<li>LogsQL reference: <a target="_blank" rel="noopener" href="https://docs.victoriametrics.com/victorialogs/logsql/">https://docs.victoriametrics.com/victorialogs/logsql/</a></li>
</ul>

        </article>
      </section>

      
      
        <nav class="article-nav">
          
          
            <div class="article-nav-item layout-padding">
  <article class="card-container article-nav-card content-padding--primary soft-size--large soft-style--box">
    
    <div class="card-text">
      
        <a href="/2024/12/2024-summary/" itemprop="url">
          <h2 class="card-text--title text-ellipsis">2024 ÁöÑËÆ∞ÂΩï</h2>
        </a>
      
      <div class="card-text--row">Older</div>
    </div>
  </article>
</div>
          
        </nav>
      

      <section class="page-message-container layout-padding">
        


  
  

  
  


      </section>
    </div>
    <div class="widget-info">
      <section class="widget-author widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-body">
    
      <img src="https://github.com/waynexia.png" class="soft-size--round soft-style--box" alt="Wayne">
    
    
      <h2>Wayne</h2>
    
    

    <!-- <div class="count-box">
      <div class="count-box--item">
        <svg class="icon icon-article" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M240.51564747 647.74217627h196.07203239c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806V165.10332731c0-33.18142087-30.16492806-60.32985613-60.32985612-60.32985611H245.04038668C225.43318342 104.7734712 210.35071939 119.85593522 210.35071939 139.46313845V617.57724821c0 16.59071043 13.57421762 30.16492806 30.16492808 30.16492806z m663.62841731-452.47392089v482.63884894c0 33.18142087-27.14843525 60.32985613-60.32985612 60.32985613H180.18579134c-33.18142087 0-60.32985613-27.14843525-60.32985612-60.32985613V195.26825538c-49.77213131 0-90.49478418 40.72265287-90.49478417 90.49478417v452.4739209c0 49.77213131 40.72265287 90.49478418 90.49478417 90.49478417h286.56681657c16.59071043 0 30.16492806 13.57421762 30.16492807 30.16492807s13.57421762 30.16492806 30.16492805 30.16492806h90.49478418c16.59071043 0 30.16492806-13.57421762 30.16492805-30.16492806s13.57421762-30.16492806 30.16492807-30.16492807h286.56681657c49.77213131 0 90.49478418-40.72265287 90.49478417-90.49478417V285.76303955c0-49.77213131-40.72265287-90.49478418-90.49478417-90.49478417zM587.41232014 647.74217627h191.54729318c19.60720323 0 34.68966726-15.08246403 34.68966729-34.68966727V134.93839925c0-16.59071043-13.57421762-30.16492806-30.16492808-30.16492805H617.57724821c-30.16492806 0-60.32985613 27.14843525-60.32985612 60.32985611v452.4739209c0 16.59071043 13.57421762 30.16492806 30.16492805 30.16492806z" fill="currentColor"></path>
</svg>
        <span>18</span>
      </div>
      <div class="count-box--item">
        <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
        0
      </div>
      <div class="count-box--item">
        <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
        6
      </div>
    </div> -->

    
    <div class="social-icons">
      
        
      
        
      
        
      
        
          <a href="https://github.com/waynexia/" class="soft-size--primary" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
</svg>
          </a>
        
      
        
          <a href="https://twitter.com/wayne17229928" class="soft-size--primary" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-twitter" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M962.285714 233.142857q-38.285714 56-92.571429 95.428571 0.571429 8 0.571429 24 0 74.285714-21.714286 148.285714t-66 142-105.428571 120.285714-147.428571 83.428571-184.571429 31.142857q-154.857143 0-283.428571-82.857143 20 2.285714 44.571429 2.285714 128.571429 0 229.142857-78.857143-60-1.142857-107.428571-36.857143t-65.142857-91.142857q18.857143 2.857143 34.857143 2.857143 24.571429 0 48.571429-6.285714-64-13.142857-106-63.714286t-42-117.428571l0-2.285714q38.857143 21.714286 83.428571 23.428571-37.714286-25.142857-60-65.714286t-22.285714-88q0-50.285714 25.142857-93.142857 69.142857 85.142857 168.285714 136.285714t212.285714 56.857143q-4.571429-21.714286-4.571429-42.285714 0-76.571429 54-130.571429t130.571429-54q80 0 134.857143 58.285714 62.285714-12 117.142857-44.571429-21.142857 65.714286-81.142857 101.714286 53.142857-5.714286 106.285714-28.571429z"></path>
</svg>
          </a>
        
      
        
          <a href="https://twitter.com/wayne17229928" class="soft-size--primary" target="_blank" rel="noopener noreferrer">
            <svg class="icon icon-mastodon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
  <path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path>
</svg>

          </a>
        
      
      
        <a rel="alternate" href="/atom.xml" title="Wonderland" type="application/atom+xml">
          <svg class="icon icon-rss" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path>
</svg>
        </a>
      
    </div>
     
    
  </div>
</section>

      <!--  -->

      <!-- <section class="widget-categorys widget-item layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-categories" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M900.3614811 257.09082106h-339.81629553l-67.96326003-101.9448889c-19.41807444-29.12711113-48.54518557-43.69066667-82.52681443-43.69066667H123.6385189c-53.39970333 0-97.09036999 43.69066667-97.09037113 97.09036999v582.54222222c0 53.39970333 43.69066667 97.09036999 97.09037113 97.09037002h776.7229622c53.39970333 0 97.09036999-43.69066667 97.09037113-97.09037002V354.18119104c0-53.39970333-43.69066667-97.09036999-97.09037113-97.09036998z m-97.09036999 242.72592554H220.72888889c-24.27259221 0-48.54518557-24.27259221-48.54518556-48.54518556s24.27259221-48.54518557 48.54518556-48.54518444h582.54222222c24.27259221 0 48.54518557 24.27259221 48.54518556 48.54518444s-24.27259221 48.54518557-48.54518556 48.54518556z" fill="currentColor"></path>
</svg>
    <span>CATEGORYS</span>
  </div>
  <div class="widget-body">
    <ul class="categorys-list">
      
    </ul>
  </div>
</section> -->

      <section class="widget-tags widget-item  layout-margin content-padding--primary soft-size--large soft-style--box">
  <div class="widget-title">
    <svg class="icon icon-tags" viewBox="0 0 1098 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M283.42180005 272q0-28.38857157-20.09142843-48.48000001t-48.47999998-20.09142842-48.48000002 20.09142842-20.09142846 48.48000001 20.09142846 48.48 48.48000002 20.09142843 48.47999998-20.09142843 20.09142843-48.48zM855.0332285 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.03999997 263.58857157q-20.9142853 19.81714313-48.75428534 19.81714312-28.38857157 0-48.20571468-19.81714312l-383.04-383.58857157q-20.36571468-19.81714313-34.55999999-54.10285688t-14.19428534-62.6742853l0-222.85714313q0-27.84000002 20.36571469-48.20571469t48.2057147-20.36571466l222.85714313 0q28.38857157 0 62.6742853 14.19428529t54.65142842 34.55999999l383.04000001 382.49142843q19.81714313 20.9142853 19.81714314 48.75428532zM1060.74751475 580.57142843q0 28.38857157-19.81714313 48.2057147l-263.04 263.58857157q-20.9142853 19.81714313-48.75428531 19.81714312-19.26857155 0-31.61142843-7.47428531t-28.38857159-24.13714314l251.79428534-251.7942853q19.81714313-19.81714313 19.81714308-48.20571469 0-27.84000002-19.81714308-48.75428531l-383.04000001-382.49142845q-20.36571468-20.36571468-54.65142842-34.55999999t-62.67428532-14.19428534l120 0q28.38857157 0 62.67428532 14.19428534t54.65142842 34.55999999l383.03999998 382.49142845q19.81714313 20.9142853 19.81714314 48.75428531z" fill="currentColor"></path>
</svg>
    <span>Tags</span>
  </div>
  <div class="widget-body">
    <div class="tags-cloud">
      <!-- <a href="/tags/Device/" style="font-size: 10px;" class="tags-cloud-0">Device</a> <a href="/tags/Experience/" style="font-size: 20px;" class="tags-cloud-10">Experience</a> <a href="/tags/Game/" style="font-size: 16.67px;" class="tags-cloud-7">Game</a> <a href="/tags/Paper-Reading/" style="font-size: 13.33px;" class="tags-cloud-3">Paper Reading</a> <a href="/tags/Rust/" style="font-size: 20px;" class="tags-cloud-10">Rust</a> <a href="/tags/Slides/" style="font-size: 13.33px;" class="tags-cloud-3">Slides</a> -->
      
          <a href="/tags/Paper-Reading/">
            Paper Reading (2)
          </a>
      
          <a href="/tags/Rust/">
            Rust (5)
          </a>
      
          <a href="/tags/Slides/">
            Slides (2)
          </a>
      
          <a href="/tags/Experience/">
            Experience (5)
          </a>
      
          <a href="/tags/Game/">
            Game (3)
          </a>
      
          <a href="/tags/Device/">
            Device (1)
          </a>
      
    </div>
  </div>
</section>

      <!-- todo: only sticky TOC list -->
      
<section class="widget-toc widget-item layout-margin content-padding--primary soft-size--large soft-style--box sticky_element">
  <div class="widget-title">
    <svg class="icon icon-toc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M134.50666666 767.46666668H460.8c27.73333333 0 50.24000001 22.50666668 50.24000001 50.23999999v50.13333333c0 27.73333333-22.50666668 50.24000001-50.24000001 50.24000001H134.50666666c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.24000001v-50.13333333c0.10666668-27.73333333 22.50666668-50.24000001 50.24000001-50.24000001zM84.37333332 541.65333333h326.18666669c27.73333333 0 50.24000001 22.39999999 50.23999999 50.13333334v50.24000001c0 27.73333333-22.50666668 50.24000001-50.24000002 50.23999999H84.37333332c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.23999999v-50.24000001c0-27.73333333 22.50666668-50.13333334 50.24000001-50.13333334zM134.50666666 315.83999999H460.8c27.73333333 0 50.24000001 22.50666668 50.24000001 50.24000001v50.24000001c0 27.73333333-22.50666668 50.13333334-50.24000001 50.13333333H134.50666666c-27.73333333 0-50.24000001-22.39999999-50.23999999-50.13333333v-50.24000001c0.10666668-27.84000001 22.50666668-50.24000001 50.24000001-50.23999999zM209.81333332 89.91999999h326.18666671c27.73333333 0 50.24000001 22.39999999 50.23999997 50.13333335v50.23999999c0 27.73333333-22.50666668 50.24000001-50.24000001 50.24000001H209.81333332c-27.73333333 0-50.24000001-22.50666668-50.23999999-50.24000001v-50.24000001c0-27.73333333 22.50666668-50.13333334 50.24000001-50.13333333zM692.05333333 623.36l274.66666669 176.00000002c23.36000001 14.93333333 30.08 45.97333334 15.14666666 69.33333332L954.77333334 910.93333333c-14.93333333 23.25333334-45.97333334 30.08-69.33333335 15.14666667l-274.66666666-176c-23.36000001-14.93333333-30.08-45.97333334-15.14666667-69.33333333l27.09333334-42.24000001c14.93333333-23.36000001 46.08000001-30.08 69.33333333-15.14666666z" fill="currentColor"></path>
</svg>
    <span>Content</span>
  </div>
  <div class="widget-body">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Overview"><span class="toc-text">Overview</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Code-line-count"><span class="toc-text">Code line count</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Key-concepts"><span class="toc-text">Key concepts</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Storage"><span class="toc-text">Storage</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ingest"><span class="toc-text">Ingest</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Storage-Block"><span class="toc-text">Storage - Block</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Storage-IndexDB"><span class="toc-text">Storage - IndexDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Storage-Cache"><span class="toc-text">Storage - Cache</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Query"><span class="toc-text">Query</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Query-Filter"><span class="toc-text">Query - Filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Query-Pipes"><span class="toc-text">Query - Pipes</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Misc"><span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON"><span class="toc-text">JSON</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pool-anywhere"><span class="toc-text">Pool anywhere</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arena"><span class="toc-text">Arena</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-text">Reference</span></a></li></ol>
  </div>
</section>


    </div>
  </article>
</div>

    <!-- footer container -->
<footer id="footer" class="footer">
  <div class="footer-container">
    <p>
      &copy; 2025 <a href="/" target="_blank">Wayne</a>
      
        |
        <a rel="alternate" href="/atom.xml" title="Wonderland" type="application/atom+xml">
          <svg class="icon icon-rss" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm64 120c0 17.7-14.3 32-32 32s-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32z"></path>
</svg>
        </a>
      
    </p>

    

    <p>Powered by <a href="https://hexo.io" target="_blank" rel="noopener noreferrer">Hexo</a> - <a href="https://github.com/waynexia/flexblock-modified" target="_blank" rel="noopener noreferrer author">This theme</a> is customized from <a href="https://github.com/miiiku/flex-block" target="_blank" rel="noopener noreferrer author">flex-block</a></p>

    <script data-goatcounter="https://waynest.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

  </div>
</footer>
  </div>

  <div class="back-to-top-fixed soft-size--round soft-style--box">
    <svg class="icon icon-back-to-top" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
      <path d="M725.333333 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8l-213.333333-213.333333c-17.066667-17.066667-17.066667-42.666667 0-59.733333s42.666667-17.066667 59.733333 0l213.333333 213.333333c17.066667 17.066667 17.066667 42.666667 0 59.733333C746.666667 422.4 738.133333 426.666667 725.333333 426.666667z"></path>
      <path d="M298.666667 426.666667c-12.8 0-21.333333-4.266667-29.866667-12.8-17.066667-17.066667-17.066667-42.666667 0-59.733333l213.333333-213.333333c17.066667-17.066667 42.666667-17.066667 59.733333 0s17.066667 42.666667 0 59.733333l-213.333333 213.333333C320 422.4 311.466667 426.666667 298.666667 426.666667z"></path>
      <path d="M512 896c-25.6 0-42.666667-17.066667-42.666667-42.666667L469.333333 170.666667c0-25.6 17.066667-42.666667 42.666667-42.666667s42.666667 17.066667 42.666667 42.666667l0 682.666667C554.666667 878.933333 537.6 896 512 896z"></path>
    </svg>
  </div>

  
  <!-- aplayer -->


<!-- dplayer -->




  


  


  




<script src="/js/script.js"></script>


  
  <!-- Â∞æÈÉ®Áî®Êà∑Ëá™ÂÆö‰πâÁõ∏ÂÖ≥ÂÜÖÂÆπ -->
</body>
</html>